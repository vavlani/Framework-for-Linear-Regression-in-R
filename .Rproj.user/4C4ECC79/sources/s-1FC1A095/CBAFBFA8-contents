skim(mpg)

library(ggplot2)
library(caret)

data(mpg)

df <- mpg

df <- select(df, -manufacturer, -model, -trans, -hwy)
df$year <- as.factor(df$year)
df$class <- as.factor(df$class)
df$drv <- as.factor(df$drv)
df$fl <- as.factor(df$fl)


dummy_vars <- dummyVars(cty ~ ., data = df, fullRank = TRUE)
df_x <- predict(dummy_vars, newdata = df)
head(df_x)

?dummyVars

df <- data.frame(cbind(cty = df$cty, df_x))
df


head(data.frame(cbind(cty = df$cty, df_x)))
class(data.frame(cbind(cty = df$cty, df_x)))

comboInfo <- findLinearCombos(matrix(df))
comboInfo
head(df)
class(df)
?findLinearCombos

head(select(df, -comboInfo$remove))

!(is.null(comboInfo$remove))

nzv <- nearZeroVar(df, saveMetrics = TRUE)
nzv

# Checking for zero var columns - there are none in our dataset
nzv[nzv$zeroVar,]
if length(which(nzv[,"zeroVar"] > 0))>0 
# We want to remove columns where zeroVar is true
df[,-(which(nzv[,"nzv"] > 0))]
dim(df)
length(which(nzv[,"zeroVar"] > 0)) > 0 
if (length(which(nzv[,"zeroVar"] > 0)) > 0) {
  df <- df[,-(which(nzv[,"zeroVar"] > 0))]
}

df_x <- select(df, -cty)
cor_mat <- cor(df_x)
summary(cor_mat[upper.tri(cor_mat)])

high_cor <- findCorrelation(cor_mat, cutoff = .85)
high_cor
library(corrplot)

corrplot(cor_mat, method = "number", type = "upper", 
         number.cex = 0.8, tl.cex = 0.8, cl.cex = 0.8)
?corrplot
head(select(df_x, -high_cor))

head(cbind(cty = df$cty, select(df_x, -high_cor)),3)
head(data.frame(cbind(cty = df$cty, select(df_x, -high_cor))), 3)

head(df)
filteredDescr <- filteredDescr[,-highlyCorDescr]
descrCor2 <- cor(filteredDescr)
summary(descrCor2[upper.tri(descrCor2)])


pre_proc <- preProcess(select(df, -cty), method = c("center", "scale"))

# predict function is the one which actually preprocesses the data
df_x_transform <- predict(pre_proc, select(df, -cty))
head(df_x_transform, 4)

head(df, 4)
?qqnorm

qqnorm(y = scale(residuals(lm_fit), center = TRUE))
qqline(y = scale(residuals(lm_fit), center = TRUE))
